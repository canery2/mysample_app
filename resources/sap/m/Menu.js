/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/library","sap/ui/core/library","sap/ui/core/Control","sap/m/ResponsivePopover","sap/m/Button","sap/m/Bar","sap/m/Title","sap/m/MenuItem","sap/m/MenuWrapper","sap/ui/core/Lib","sap/ui/Device","sap/ui/core/InvisibleText","sap/ui/core/EnabledPropagator","sap/base/i18n/Localization","sap/base/Log"],function(e,t,o,n,s,i,r,p,u,a,l,c,h,m,d){"use strict";const f=e.PlacementType;const g=t.ItemSelectionMode;const _=o.extend("sap.m.Menu",{metadata:{interfaces:["sap.ui.core.IContextMenu"],library:"sap.m",properties:{title:{type:"string",group:"Misc",defaultValue:null}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.IMenuItem",multiple:true,singularName:"item",bindable:"bindable",defaultClass:p,forwarding:{idSuffix:"-menuWrapper",aggregation:"items"}},_menuWrapper:{type:"sap.m.MenuWrapper",multiple:false,visibility:"hidden"},_popover:{type:"sap.m.ResponsivePopover",multiple:false,visibility:"hidden"}},events:{itemSelected:{parameters:{item:{type:"sap.m.IMenuItem"}}},closed:{},beforeClose:{allowPreventDefault:true,parameters:{item:{type:"sap.m.IMenuItem"}}}}},renderer:null});h.call(_.prototype);_.prototype.init=function(){const e=this._createMenuWrapper(),t=this._createPopover();e.attachClosePopover(this.close,this);e.attachCloseItemSubmenu(this._collectSubmenusToClose,this);e.attachItemSelected(this._handleItemSelected,this);t.attachAfterClose(this._menuClosed,this);this._aSubmenusToClose=[];this._openDuration=l.system.phone?null:0};_.prototype.exit=function(){const e=this._getMenuWrapper(),t=this._getPopover();e.detachClosePopover(this.close,this);e.detachCloseItemSubmenu(this._collectSubmenusToClose,this);e.detachItemSelected(this._handleItemSelected,this);t.detachAfterClose(this._menuClosed,this);e.destroy();t.destroy()};_.prototype.setTitle=function(e){const t=this._getPopover(),o=this._getMenuWrapper(),n=t.getCustomHeader();if(n){o.setTitle(e);n.getContentMiddle()[0].setText(e)}this.setProperty("title",e,true);return this};_.prototype.openBy=function(e){const t=this._getPopover(),o=this.getBinding("items");if(!e){e=document.body}if(o&&o.isA("sap.ui.model.odata.v4.ODataListBinding")){o.attachEventOnce("dataReceived",function(){this._openPopoverBy(t,e)},this)}else{this._openPopoverBy(t,e)}this.bIgnoreOpenerFocus=true;return this};_.prototype.close=function(e){const t=e?e.getParameters():{},o={},n=this._getPopover();if(t["origin"]){o["item"]=t["origin"]}this._refreshSubmenusToClose();if(n&&this.fireBeforeClose(o)){this._closeSubmenuPopovers();n._getPopup().setDurations(this._openDuration,0);n.close()}return this};_.prototype._openPopoverBy=function(e,t){e._getPopup().setDurations(this._openDuration,0);e.openBy(t)};_.prototype._handleItemSelected=function(e){e.cancelBubble();this.fireItemSelected({item:e.getParameter("item")});this.bIgnoreOpenerFocus=false};_.prototype._refreshSubmenusToClose=function(){this._aSubmenusToClose=this._aSubmenusToClose.filter(e=>e._getPopover().isOpen())};_.prototype._closeSubmenuPopovers=function(){while(this._aSubmenusToClose.length){this._aSubmenusToClose.pop()._closeSubmenu()}};_.prototype.isOpen=function(){return this._getPopover().isOpen()};_.prototype.getDomRefId=function(){const e=this._getPopover().getDomRef();return e?e.id:""};_.prototype.openAsContextMenu=function(e,t){const o=this._getPopover(),n=e?e.originalEvent||e:null,s=n&&n.button!==undefined&&!!n.type,i=n&&!s&&n.type===undefined&&(n.offsetX!==undefined&&n.offsetY!==undefined),r=n.type?.substr(0,3)==="key"||s&&t&&(n.pageX===undefined&&n.clientX===undefined||n.pageY===undefined&&n.clientY===undefined);let p=t&&t.getDomRef?t.getDomRef():t,u=document.getElementById("sapMMenuContextMenuPointer"),a=document.body,c=null,h=0,d=0;o._getPopup().setDurations(this._openDuration,0);if(o.isOpen()){o.close()}if(l.system.phone){o.openBy();return}if(!t&&!i){p=e.srcControl?e.srcControl.getDomRef():null;if(!p){if(n?.currentTarget){p=n.currentTarget}else if(n?.target){p=n.target}else{p=document.body}}}if(u){u.remove()}u=document.createElement("div");u.id="sapMMenuContextMenuPointer";u.className="sapMMenuContextMenuPointer";const f=p?p.getBoundingClientRect():null;if((!n||r)&&f){h=f.left+f.width/2+(document.documentElement.scrollLeft||document.body.scrollLeft);d=f.top+f.height/2+(document.documentElement.scrollTop||document.body.scrollTop)}else if(n&&s){const e=(n.pageX||n.clientX)+(document.documentElement.scrollLeft||document.body.scrollLeft);const t=(n.pageY||n.clientY)+(document.documentElement.scrollTop||document.body.scrollTop);if(p.tagName&&p.tagName.toLowerCase()==="tr"){a=p.firstChild?p.firstChild:p;c=a.firstChild?a.firstChild:null}else{a=p;c=p.firstChild?p.firstChild:null}h=e-f.left-window.scrollX;d=t-f.top-window.scrollY;if(m.getRTL()){h=document.body.clientWidth-h}}else if(i){h=e.offsetX||0;d=e.offsetY||0}a.insertBefore(u,c);u.style.insetInlineStart=`${h}px`;u.style.insetBlockStart=`${d}px`;u.setAttribute("aria-hidden","true");o.openBy(u);o.attachAfterClose(this._onContextMenuClose,this)};_.prototype._onContextMenuClose=function(){const e=document.getElementById("sapMMenuContextMenuPointer"),t=this._getPopover();e&&e.remove();t.detachAfterClose(this._onContextMenuClose,this)};["addStyleClass","removeStyleClass","toggleStyleClass"].forEach(function(e){_.prototype[e]=function(t,n){const s=this._getPopover();this._getMenuWrapper()._processStyleClasses(t,e);o.prototype[e].apply(this,arguments);if(e!=="toggleStyleClass"&&s){s[e].apply(s,arguments)}return this}});_.prototype.getSelectedItems=function(){return this._getItems().filter(e=>e.getSelected&&e.getSelected()&&e._getItemSelectionMode()!==g.None)};_.prototype._collectSubmenusToClose=function(e){const t=e.getParameter("item");this._refreshSubmenusToClose();if(this._aSubmenusToClose.indexOf(t)===-1){this._aSubmenusToClose.push(t)}};_.prototype._setCustomEnhanceAccStateFunction=function(e){this._fnEnhanceUnifiedMenuAccState=e};_.prototype._menuClosed=function(e){const t=e&&e.getParameter("openBy");this.fireClosed();if(t&&!this.bIgnoreOpenerFocus){try{t.focus()}catch(e){d.warning("Menu.close cannot restore the focus on opener "+t+", "+e)}}};_.prototype._isMenuItemGroup=function(e){return!!e.getItemSelectionMode};_.prototype._getItems=function(){const e=[];const t=o=>{o.forEach(o=>{if(!this._isMenuItemGroup(o)){e.push(o)}else{t(o.getItems())}})};t(this.getItems());return e};_.prototype._createMenuWrapper=function(e){const t=new u(this.getId()+"-menuWrapper",{isSubmenu:e});this.setAggregation("_menuWrapper",t,true);return t};_.prototype._createPopover=function(){let e=this._getPopover();if(e){return e}const t=l.system.phone?`${this.getId()}-title`:c.getStaticId("sap.m","MENU_POPOVER_ACCESSIBLE_NAME");const o=this._getMenuWrapper(),s=m.getRTL(),i=o.getIsSubmenu(),r=s?4:-4;e=new n(this.getId()+"-rp",{placement:this._getPopoverPlacement(),showHeader:false,showArrow:false,showCloseButton:false,verticalScrolling:true,horizontalScrolling:false,offsetX:i?r:1,offsetY:i?4:1,content:o,ariaLabelledBy:[t]});e.addStyleClass("sapMMenu");this.setAggregation("_popover",e,true);if(l.system.phone){e.setShowHeader(true);e.setEndButton(this._createCloseButton());e.setCustomHeader(this._createHeaderBar())}else if(i){e.getAggregation("_popup")._adaptPositionParams=function(){this._marginTop=0;this._marginLeft=0;this._marginRight=0;this._marginBottom=0;this._arrowOffset=0;this._offsets=["0 0","0 0","0 0","0 0"];this._myPositions=["begin bottom","begin top","begin top","end top"];this._atPositions=["begin top","end top","begin bottom","begin top"]}}e._oControl._getDocHeight=()=>window.innerHeight+window.scrollY;return e};_.prototype._createBackButton=function(){return new s(this.getId()+"-backbutton",{icon:"sap-icon://nav-back",press:e=>{this._getMenuWrapper().fireClosePopover()}})};_.prototype._createHeaderBar=function(){const e=this._getMenuWrapper(),t=new i({contentMiddle:new r(this.getId()+"-title",{text:e.getTitle()})}),o=this._getMenuWrapper().getIsSubmenu();if(o){t.addContentLeft(this._createBackButton())}return t};_.prototype._createCloseButton=function(){const e=a.getResourceBundleFor("sap.m");return new s({text:e.getText("MENU_CLOSE"),press:()=>{this._getMenuWrapper().fireClosePopover({bubbleToRoot:true})}})};_.prototype._getMenuWrapper=function(){const e=this._getPopover();return e?e.getContent()[0]:this.getAggregation("_menuWrapper")};_.prototype._getPopover=function(){return this.getAggregation("_popover")};_.prototype._getPopoverPlacement=function(){const e=this._getMenuWrapper().getIsSubmenu();if(e){const e=m.getRTL(),t=e?f.HorizontalPreferredLeft:f.HorizontalPreferredRight;return t}return f.VerticalPreferredBottom};_.prototype._setExtraContent=function(e){this._getPopover()._getPopup().setExtraContent([e])};return _});
//# sourceMappingURL=Menu.js.map